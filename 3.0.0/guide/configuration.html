<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>3 The Configuration Mechanism 2.0.0.RC2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        jms
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/jmsProvider.html"><strong>2</strong><span>Plugging In A JMS Provider</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/configuration.html"><strong>3</strong><span>The Configuration Mechanism</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/sendingMessages.html"><strong>4</strong><span>Sending Messages</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/receivingMessages.html"><strong>5</strong><span>Receiving Messages</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/receivingMessagesWithSelectors.html"><strong>6</strong><span>Receiving Messages With Selectors</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/browsingMessagesInQueue.html"><strong>7</strong><span>Browsing Messages In A Queue</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/messageConversion.html"><strong>8</strong><span>Message Conversion</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/logging.html"><strong>9</strong><span>Logging</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/disablingAndReloading.html"><strong>10</strong><span>Disabling And Reloading</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/jmsProvider.html">&lt;&lt; <strong>2</strong><span>Plugging In A JMS Provider</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/sendingMessages.html"><strong>4</strong><span>Sending Messages</span> >></a></div>
                


                <div class="project">
                    <h1>3 The Configuration Mechanism</h1>

                    <p><strong>Version:</strong> 2.0.0.RC2</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#changingDefaults"><strong>3.1</strong><span>Changing Defaults</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#syntaxNotes"><strong>3.2</strong><span>Syntax Notes</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="configuration">3 The Configuration Mechanism</h1>


JMS is a complicated topic. There are different consumption and configuration patterns. While this plugin does set some reasonable defaults, it's very likely that you are going to need to customise these settings either globally or for specific senders or listeners.<p class="paragraph"/>To support this, the plugin makes configuration options available to you should you need to set it. This is achieved through the use of Spring's abstract beans and Grails' configuration mechanism.<p class="paragraph"/><h3>How it works</h3><p class="paragraph"/>The configuration is controlled by the Grails application configuration under the key <code>jms</code>. This is merged against plugin provided defaults.<p class="paragraph"/>Here is what the defaults look like...<p class="paragraph"/><div class="code"><pre>templates:
    standard:
        connectionFactoryBean: jmsConnectionFactory
        messageConverterBean: standardJmsMessageConverter<p class="paragraph"/>...</pre></div><p class="paragraph"/>That creates a map of "bean definitions" that get processed into real bean definitions.<p class="paragraph"/>The default config creates our standard (i.e. default) converters, jms templates for sending, and listener containers and adapters for receiving.<p class="paragraph"/>When sending messages with the <code>jmsService</code> you can specify which template to use to send the message. If none is specified, "standard" is used.<p class="paragraph"/>Likewise, listeners can specify which container and/or adapter bean definition to base themselves on. If none are specified, "standard" is used in both cases.



<h2 id="changingDefaults">3.1 Changing Defaults</h2>


You can override the configuration defaults very easily.<p class="paragraph"/>Let's suppose you do not want any message conversion on listeners. If a listener container has no <code>messageConverter</code> listeners will receive raw messages. So we want to override the standard listener container definition to set the <code>messageConverter</code> property to <code>null</code>.<p class="paragraph"/>In your application's <code>application.yml</code><p class="paragraph"/><div class="code"><pre>jms:
    containers:
        standard:
            messageConverter: <span class="java&#45;keyword">null</span></pre></div><p class="paragraph"/>This definition will get merged against the plugin provided defaults to produce a standard listener container definition with <code>messageConverter</code> set to <code>null</code>.<p class="paragraph"/><h3>Disabling the default dependency on the Persistence Interceptor.</h3><p class="paragraph"/>If you are not using any <strong class="bold">GORM</strong> implementation such as <strong class="bold">Grails Hibernate Plugin</strong>
(i.e. you uninstalled the <strong class="bold">hibernate</strong> plugin) or the <strong class="bold">GORM</strong> implementation you are using doesn't provide a
<strong class="bold"></strong>Persistence Interceptor Bean<strong class="bold"></strong>, you will have to disable the  <em class="italic">default</em> 
dependency to the <strong class="bold"></strong>Persistence Interceptor Bean<strong class="bold"></strong>. You can do this by setting
in the <code>application.yml</code> the <code>jms.adapters.standard.persistenceInterceptorBean</code> to <code>null</code> .<p class="paragraph"/><div class="code"><pre>jms:
    adapters:
        standard:
            persistenceInterceptorBean: <span class="java&#45;keyword">null</span></pre></div>



<h2 id="syntaxNotes">3.2 Syntax Notes</h2>


There are some noteworthy things about this config syntax.<p class="paragraph"/><h4>Bean names</h4><p class="paragraph"/>The beans created automatically get suffixes applied to them. Template bean names get suffixed with 'JmsTemplate', container beans get suffixed with 'JmsListenerContainer' and adapter beans get suffixed with 'JmsListenerAdapter'.<p class="paragraph"/><h4>Setting Beans</h4><p class="paragraph"/>To set a property to another Spring bean, simply append <code>Bean</code> to the property name and set the property to the name of the bean.<p class="paragraph"/>Here is how the standard template is defined to use the bean named <code>jmsConnectionFactory</code> as it's connection factory...<p class="paragraph"/><div class="code"><pre>templates &#123;
    standard &#123;
        connectionFactoryBean = <span class="java&#45;quote">"jmsConnectionFactory"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Setting Class</h4><p class="paragraph"/>To set the class of a bean, you must use the following syntax<p class="paragraph"/><div class="code"><pre>templates &#123;
    standard &#123;
        meta &#123;
            clazz = my.org.CustomJmsTemplate
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Extending Definitions</h4><p class="paragraph"/>Bean definition can inherit from parents and selectively override settings.<p class="paragraph"/><div class="code"><pre>templates &#123;
    other &#123;
        meta &#123;
            parentBean = 'standardJmsTemplate'
        &#125;
        connectionFactoryBean = <span class="java&#45;quote">"someOtherJmsConnectionFactory"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>This creates an "other" template, that inherits all of the standard settings but uses a custom connectionFactory.


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/jmsProvider.html">&lt;&lt; <strong>2</strong><span>Plugging In A JMS Provider</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/sendingMessages.html"><strong>4</strong><span>Sending Messages</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Service</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../ref/Service/receiveSelectedAsyncJMSMessage.html">receiveSelectedAsyncJMSMessage</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Service/receiveSelectedJMSMessage.html">receiveSelectedJMSMessage</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Service/sendJMSMessage.html">sendJMSMessage</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Service/sendPubSubJMSMessage.html">sendPubSubJMSMessage</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Service/sendQueueJMSMessage.html">sendQueueJMSMessage</a>
                            </div>
                            
                            <div class="menu-item"><a href="../ref/Service/sendTopicJMSMessage.html">sendTopicJMSMessage</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
